<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SNS Growth Rank</title>
  <style>
    :root { color-scheme: dark; }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; background:#0b0f14; color:#e7eef7; }
    a{ color:inherit; text-decoration:none; }
    .wrap{ min-height:100vh; display:grid; grid-template-columns: 1fr min(980px, 92vw) 1fr; gap:24px; padding:20px 0; }
    .side{ display:none; }
    .card{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .topbar{ display:flex; align-items:center; gap:10px; justify-content:space-between; margin-bottom:12px; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:700; }
    .dot{ width:10px; height:10px; border-radius:999px; background:#ff4d4d; box-shadow:0 0 14px rgba(255,77,77,.5); }
    .meta{ opacity:.75; font-size:12px; }
    .tabs{ display:flex; gap:8px; margin:10px 0 14px; flex-wrap:wrap; }
    .tab{ padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); font-size:12px; }
    .search{ display:flex; gap:10px; align-items:center; margin:10px 0 12px; }
    input{ flex:1; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.25); color:#e7eef7; outline:none; }
    .count{ font-size:12px; opacity:.75; }
    .list{ display:grid; gap:10px; }
    .row{ display:grid; grid-template-columns: 42px 1fr 90px; gap:12px; align-items:center; padding:10px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03); }
    .rank{ width:34px; height:34px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); font-weight:700; }
    .title{ font-weight:650; line-height:1.25; }
    .url{ font-size:12px; opacity:.65; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .views{ text-align:right; font-variant-numeric: tabular-nums; font-weight:700; }
    .small{ font-size:12px; opacity:.75; }
    .error{ margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,120,120,.35); background:rgba(255,70,70,.12); color:#ffd6d6; display:none; }

    /* PCは左右に広告枠 */
    @media (min-width: 1100px){
      .side{ display:block; }
      .adbox{ position:sticky; top:20px; height: calc(100vh - 40px); border-radius:16px; border:1px dashed rgba(255,255,255,.18); background:rgba(255,255,255,.03); display:grid; place-items:center; opacity:.8; }
      .adbox span{ opacity:.6; font-size:12px; }
    }

    /* スマホは下に広告枠（固定） */
    .mobileAd{
      position:fixed; left:0; right:0; bottom:0;
      height:64px;
      background:rgba(0,0,0,.72);
      border-top:1px solid rgba(255,255,255,.10);
      display:none;
      place-items:center;
      z-index:10;
      backdrop-filter: blur(10px);
    }
    .mobileAd span{ opacity:.65; font-size:12px; }
    @media (max-width: 720px){
      body{ padding-bottom:72px; }
      .wrap{ grid-template-columns: 1fr; padding:14px 0; }
      .mobileAd{ display:grid; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="side">
      <div class="adbox"><span>AD (Left)</span></div>
    </div>

    <main class="card">
      <div class="topbar">
        <div class="brand"><span class="dot"></span><span>SNS Growth Rank</span></div>
        <div class="meta" id="metaRight">Wikipedia / JP</div>
      </div>

      <div class="small">Wikipedia 急上昇（自動更新）</div>

      <div class="tabs">
        <div class="tab">入力</div>
        <div class="tab">1日</div>
        <div class="tab">3日</div>
        <div class="tab">週間</div>
      </div>

      <div class="search">
        <input id="q" placeholder="検索（例：俳優 / アニメ / 地名）" />
        <div class="count" id="count">--件</div>
      </div>

      <div class="list" id="list"></div>
      <div class="error" id="errBox"></div>
    </main>

    <div class="side">
      <div class="adbox"><span>AD (Right)</span></div>
    </div>
  </div>

  <div class="mobileAd"><span>AD (Bottom)</span></div>

  <script>
    const listEl = document.getElementById("list");
    const qEl = document.getElementById("q");
    const countEl = document.getElementById("count");
    const metaRight = document.getElementById("metaRight");
    const errBox = document.getElementById("errBox");

    function fmt(n){
      try { return new Intl.NumberFormat("ja-JP").format(n); }
      catch { return String(n); }
    }

    function showError(msg){
      errBox.style.display = "block";
      errBox.textContent = msg;
    }

    function render(items){
      const q = (qEl.value || "").trim().toLowerCase();
      const filtered = q
        ? items.filter(x => (x.title || "").toLowerCase().includes(q))
        : items;

      countEl.textContent = filtered.length + "件";

      listEl.innerHTML = filtered.map(it => {
        const safeUrl = it.url || "#";
        return `
          <a class="row" href="${safeUrl}" target="_blank" rel="noopener noreferrer">
            <div class="rank">${it.rank ?? "-"}</div>
            <div>
              <div class="title">${it.title ?? ""}</div>
              <div class="url">${safeUrl}</div>
            </div>
            <div class="views">${fmt(it.views ?? 0)}</div>
          </a>
        `;
      }).join("");
    }

    async function main(){
      // ★重要：GitHub Pagesは /sns-growth-rank/ 配下なので、先頭 / を付けない（相対パス）
      const url = "./data/wiki.json";

      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("JSON取得失敗: " + res.status + " (" + url + ")");

      const data = await res.json();
      metaRight.textContent = `Wikipedia / ${data.lang || "JP"}  ${data.date || ""}`.trim();

      const items = Array.isArray(data.items) ? data.items : [];
      render(items);

      qEl.addEventListener("input", () => render(items));
    }

    main().catch(e => {
      console.error(e);
      showError(String(e && e.message ? e.message : e));
    });
  </script>
</body>
</html>
